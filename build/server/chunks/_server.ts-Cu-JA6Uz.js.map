{"version":3,"file":"_server.ts-Cu-JA6Uz.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/product/explore/_pid_/engine/_server.ts.js"],"sourcesContent":["import { e as error, j as json } from \"../../../../../../chunks/index2.js\";\nconst API_BASE_URL = \"http://host.docker.internal:8000\";\nasync function handle_too_many_engine(pid) {\n  let engineResponse = await fetch(`${API_BASE_URL}/engine/${pid}/run`);\n  if (engineResponse.status == 403) {\n    const runningEngineResponse = await fetch(`${API_BASE_URL}/engine/runningengines`);\n    const runningEngineList = await runningEngineResponse.json();\n    const delete_pid = runningEngineList.list_id[0];\n    const deleteEngineResponse = await fetch(`${API_BASE_URL}/engine/${delete_pid}/kill`, { method: \"DELETE\" });\n    if (!deleteEngineResponse.ok) {\n      throw error(engineResponse.status, `Failed to start engine for product with id ${pid}: there has been a problem trying to delete in memory engine`);\n    }\n    engineResponse = await fetch(`${API_BASE_URL}/engine/${pid}/run`);\n    if (!engineResponse.ok) {\n      throw error(engineResponse.status, `Failed to start engine for product with id ${pid}`);\n    }\n  }\n  return engineResponse;\n}\nconst GET = async ({ url, params }) => {\n  const pid = params.pid;\n  const engineResponse = await handle_too_many_engine(pid);\n  const engineStats = await engineResponse.json();\n  if (!engineResponse.ok) {\n    if (typeof engineStats.detail === \"string\" && engineStats.detail.includes(\"already exist\")) {\n      console.log(\"LOG: engine already running\");\n    } else {\n      throw error(engineResponse.status, `Failed to start engine for product with id ${pid}`);\n    }\n  }\n  return json(engineStats);\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;AACA,MAAM,YAAY,GAAG,kCAAkC;AACvD,eAAe,sBAAsB,CAAC,GAAG,EAAE;AAC3C,EAAE,IAAI,cAAc,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;AACvE,EAAE,IAAI,cAAc,CAAC,MAAM,IAAI,GAAG,EAAE;AACpC,IAAI,MAAM,qBAAqB,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,YAAY,CAAC,sBAAsB,CAAC,CAAC;AACtF,IAAI,MAAM,iBAAiB,GAAG,MAAM,qBAAqB,CAAC,IAAI,EAAE;AAChE,IAAI,MAAM,UAAU,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;AACnD,IAAI,MAAM,oBAAoB,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,YAAY,CAAC,QAAQ,EAAE,UAAU,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;AAC/G,IAAI,IAAI,CAAC,oBAAoB,CAAC,EAAE,EAAE;AAClC,MAAM,MAAM,KAAK,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,2CAA2C,EAAE,GAAG,CAAC,4DAA4D,CAAC,CAAC;AACzJ;AACA,IAAI,cAAc,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;AACrE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE;AAC5B,MAAM,MAAM,KAAK,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,2CAA2C,EAAE,GAAG,CAAC,CAAC,CAAC;AAC7F;AACA;AACA,EAAE,OAAO,cAAc;AACvB;AACK,MAAC,GAAG,GAAG,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK;AACvC,EAAE,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG;AACxB,EAAE,MAAM,cAAc,GAAG,MAAM,sBAAsB,CAAC,GAAG,CAAC;AAC1D,EAAE,MAAM,WAAW,GAAG,MAAM,cAAc,CAAC,IAAI,EAAE;AACjD,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE;AAC1B,IAAI,IAAI,OAAO,WAAW,CAAC,MAAM,KAAK,QAAQ,IAAI,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE;AAChG,MAAM,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC;AAChD,KAAK,MAAM;AACX,MAAM,MAAM,KAAK,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,2CAA2C,EAAE,GAAG,CAAC,CAAC,CAAC;AAC7F;AACA;AACA,EAAE,OAAO,IAAI,CAAC,WAAW,CAAC;AAC1B;;;;"}